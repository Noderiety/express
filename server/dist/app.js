"use strict";
require('traceur-source-maps').install(require('traceur'));
var path = require('path'),
    express = require('express'),
    hbs = require('express-hbs'),
    logger = require('morgan'),
    bodyParser = require('body-parser'),
    compress = require('compression'),
    favicon = require('static-favicon'),
    methodOverride = require('method-override'),
    p = require('songbird'),
    router = require('./middlewares/router'),
    handle404 = require('./middlewares/handle404'),
    trycatchMiddleware = require('./middlewares/trycatch');
var App = function App(config) {
  var server = this.server = express();
  this.config = config;
  hbs.registerHelper('ifvalue', function(conditional, options) {
    if (options.hash.value === conditional) {
      return options.fn(this);
    } else {
      return options.inverse(this);
    }
  });
  server.set('port', config.server.port);
  server.engine('hbs', hbs.express3());
  server.set('views', path.join(__dirname, '..', 'views'));
  server.set('view engine', 'hbs');
  server.use(trycatchMiddleware()).use(compress()).use(favicon()).use(logger('dev')).use(bodyParser()).use(methodOverride()).use(express.static(path.join(__dirname, '..', '..', 'public'))).use(router()).use(handle404());
};
($traceurRuntime.createClass)(App, {
  configureSync: function() {
    var DBDriver = require('./drivers/' + this.config.database.type);
    this.databaseDriver = new DBDriver(this.config.database);
  },
  initialize: function() {
    return p.all([this.databaseDriver.initialize(), this.server.promise.listen(this.server.get('port'))]);
  }
}, {});
module.exports = App;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5lczYuanMiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLE1BQU0sQUFBQyxDQUFDLHFCQUFvQixDQUFDLFFBQVEsQUFBQyxDQUFDLE9BQU0sQUFBQyxDQUFDLFNBQVEsQ0FBQyxDQUFDLENBQUM7RUFLdEQsQ0FBQSxJQUFHLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxNQUFLLENBQUM7QUFHckIsVUFBTSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsU0FBUSxDQUFDO0FBQzNCLE1BQUUsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLGFBQVksQ0FBQztBQUMzQixTQUFLLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxRQUFPLENBQUM7QUFDekIsYUFBUyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsYUFBWSxDQUFDO0FBQ2xDLFdBQU8sRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLGFBQVksQ0FBQztBQUNoQyxVQUFNLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxnQkFBZSxDQUFDO0FBQ2xDLGlCQUFhLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxpQkFBZ0IsQ0FBQztBQUMxQyxJQUFBLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxVQUFTLENBQUM7QUFHdEIsU0FBSyxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMsc0JBQXFCLENBQUM7QUFDdkMsWUFBUSxFQUFJLENBQUEsT0FBTSxBQUFDLENBQUMseUJBQXdCLENBQUM7QUFDN0MscUJBQWlCLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyx3QkFBdUIsQ0FBQztRQUV6RCxTQUFNLElBQUUsQ0FNTyxNQUFLO0lBQ1osQ0FBQSxNQUFLLEVBQUksQ0FBQSxJQUFHLE9BQU8sRUFBSSxDQUFBLE9BQU0sQUFBQyxFQUFDO0FBRW5DLEtBQUcsT0FBTyxFQUFJLE9BQUssQ0FBQztBQVdwQixJQUFFLGVBQWUsQUFBQyxDQUFDLFNBQVEsQ0FBRyxVQUFVLFdBQVUsQ0FBRyxDQUFBLE9BQU0sQ0FBRztBQUM1RCxPQUFJLE9BQU0sS0FBSyxNQUFNLElBQU0sWUFBVSxDQUFHO0FBQ3RDLFdBQU8sQ0FBQSxPQUFNLEdBQUcsQUFBQyxDQUFDLElBQUcsQ0FBQyxDQUFDO0lBQ3pCLEtBQU87QUFDTCxXQUFPLENBQUEsT0FBTSxRQUFRLEFBQUMsQ0FBQyxJQUFHLENBQUMsQ0FBQztJQUM5QjtBQUFBLEVBQ0YsQ0FBQyxDQUFDO0FBS0YsT0FBSyxJQUFJLEFBQUMsQ0FBQyxNQUFLLENBQUcsQ0FBQSxNQUFLLE9BQU8sS0FBSyxDQUFDLENBQUM7QUFHdEMsT0FBSyxPQUFPLEFBQUMsQ0FBQyxLQUFJLENBQUcsQ0FBQSxHQUFFLFNBQVMsQUFBQyxFQUFDLENBQUMsQ0FBQztBQUNwQyxPQUFLLElBQUksQUFBQyxDQUFDLE9BQU0sQ0FBRyxDQUFBLElBQUcsS0FBSyxBQUFDLENBQUMsU0FBUSxDQUFHLEtBQUcsQ0FBRyxRQUFNLENBQUMsQ0FBQyxDQUFDO0FBQ3hELE9BQUssSUFBSSxBQUFDLENBQUMsYUFBWSxDQUFHLE1BQUksQ0FBQyxDQUFDO0FBRWhDLE9BQUssSUFDQSxBQUFDLENBQUMsa0JBQWlCLEFBQUMsRUFBQyxDQUFDLElBQ3RCLEFBQUMsQ0FBQyxRQUFPLEFBQUMsRUFBQyxDQUFDLElBQ1osQUFBQyxDQUFDLE9BQU0sQUFBQyxFQUFDLENBQUMsSUFDWCxBQUFDLENBQUMsTUFBSyxBQUFDLENBQUMsS0FBSSxDQUFDLENBQUMsSUFDZixBQUFDLENBQUMsVUFBUyxBQUFDLEVBQUMsQ0FBQyxJQUNkLEFBQUMsQ0FBQyxjQUFhLEFBQUMsRUFBQyxDQUFDLElBQ2xCLEFBQUMsQ0FBQyxPQUFNLE9BQU8sQUFBQyxDQUFDLElBQUcsS0FBSyxBQUFDLENBQUMsU0FBUSxDQUFHLEtBQUcsQ0FBRyxLQUFHLENBQUcsU0FBTyxDQUFDLENBQUMsQ0FBQyxJQUM1RCxBQUFDLENBQUMsTUFBSyxBQUFDLEVBQUMsQ0FBQyxJQUNWLEFBQUMsQ0FBQyxTQUFRLEFBQUMsRUFBQyxDQUFDLENBQUM7QUFTdkI7QUM5RUEsQUFBQyxlQUFjLFlBQVksQ0FBQyxBQUFDO0FEdUIzQixjQUFZLENBQVosVUFBYSxBQUFDO01BQ1IsQ0FBQSxRQUFPLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxZQUFXLEVBQUUsQ0FBQSxJQUFHLE9BQU8sU0FBUyxLQUFLLENBQUM7QUFDN0QsT0FBRyxlQUFlLEVBQUksSUFBSSxTQUFPLEFBQUMsQ0FBQyxJQUFHLE9BQU8sU0FBUyxDQUFDLENBQUE7RUFDekQ7QUE4Q0EsV0FBUyxDQUFULFVBQVUsQUFBQyxDQUFFO0FBQ1gsU0FBTyxDQUFBLENBQUEsSUFBSSxBQUFDLENBQUMsQ0FDWCxJQUFHLGVBQWUsV0FBVyxBQUFDLEVBQUMsQ0FDL0IsQ0FBQSxJQUFHLE9BQU8sUUFBUSxPQUFPLEFBQUMsQ0FBQyxJQUFHLE9BQU8sSUFBSSxBQUFDLENBQUMsTUFBSyxDQUFDLENBQUMsQ0FDcEQsQ0FBQyxDQUFDO0VBQ0o7QUFBQSxLQzdFbUY7QURnRnJGLEtBQUssUUFBUSxFQUFJLElBQUUsQ0FBQztBQUNwQiIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCd0cmFjZXVyLXNvdXJjZS1tYXBzJykuaW5zdGFsbChyZXF1aXJlKCd0cmFjZXVyJykpOy8qKlxuICogTW9kdWxlIGRlcGVuZGVuY2llcy5cbiAqL1xuXG4vLyBDb3JlIG1vZHVsZXNcbmxldCBwYXRoID0gcmVxdWlyZSgncGF0aCcpLFxuXG4gICAgLy8gbm9kZV9tb2R1bGVzXG4gICAgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKSxcbiAgICBoYnMgPSByZXF1aXJlKCdleHByZXNzLWhicycpLFxuICAgIGxvZ2dlciA9IHJlcXVpcmUoJ21vcmdhbicpLFxuICAgIGJvZHlQYXJzZXIgPSByZXF1aXJlKCdib2R5LXBhcnNlcicpLFxuICAgIGNvbXByZXNzID0gcmVxdWlyZSgnY29tcHJlc3Npb24nKSxcbiAgICBmYXZpY29uID0gcmVxdWlyZSgnc3RhdGljLWZhdmljb24nKSxcbiAgICBtZXRob2RPdmVycmlkZSA9IHJlcXVpcmUoJ21ldGhvZC1vdmVycmlkZScpLFxuICAgIHAgPSByZXF1aXJlKCdzb25nYmlyZCcpLFxuXG4gICAgLy8gbG9jYWwgZGVwZW5kZW5jaWVzXG4gICAgcm91dGVyID0gcmVxdWlyZSgnLi9taWRkbGV3YXJlcy9yb3V0ZXInKSxcbiAgICBoYW5kbGU0MDQgPSByZXF1aXJlKCcuL21pZGRsZXdhcmVzL2hhbmRsZTQwNCcpLFxuICAgIHRyeWNhdGNoTWlkZGxld2FyZSA9IHJlcXVpcmUoJy4vbWlkZGxld2FyZXMvdHJ5Y2F0Y2gnKTtcblxuY2xhc3MgQXBwIHtcbiAgY29uZmlndXJlU3luYygpIHtcbiAgICBsZXQgREJEcml2ZXIgPSByZXF1aXJlKCcuL2RyaXZlcnMvJyt0aGlzLmNvbmZpZy5kYXRhYmFzZS50eXBlKTtcbiAgICB0aGlzLmRhdGFiYXNlRHJpdmVyID0gbmV3IERCRHJpdmVyKHRoaXMuY29uZmlnLmRhdGFiYXNlKVxuICB9XG5cbiAgY29uc3RydWN0b3IgKGNvbmZpZykge1xuICAgIGxldCBzZXJ2ZXIgPSB0aGlzLnNlcnZlciA9IGV4cHJlc3MoKTtcblxuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuXG4gICAgLyoqXG4gICAgICogQSBzaW1wbGUgaWYgY29uZHRpb25hbCBoZWxwZXIgZm9yIGhhbmRsZWJhcnNcbiAgICAgKlxuICAgICAqIFVzYWdlOlxuICAgICAqICAge3sjaWZ2YWx1ZSBlbnYgdmFsdWU9J2RldmVsb3BtZW50J319XG4gICAgICogICAgIGRvIHNvbWV0aGluZyBtYXJ2ZWxsb3VzXG4gICAgICogICB7ey9pZnZhbHVlfX1cbiAgICAgKiBGb3IgbW9yZSBpbmZvcm1hdGlvbiwgY2hlY2sgb3V0IHRoaXMgZ2lzdDogaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20vcGhldXRlci8zNTE1OTQ1XG4gICAgICovXG4gICAgaGJzLnJlZ2lzdGVySGVscGVyKCdpZnZhbHVlJywgZnVuY3Rpb24gKGNvbmRpdGlvbmFsLCBvcHRpb25zKSB7XG4gICAgICBpZiAob3B0aW9ucy5oYXNoLnZhbHVlID09PSBjb25kaXRpb25hbCkge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5mbih0aGlzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLmludmVyc2UodGhpcyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBFeHByZXNzIGNvbmZpZ3VyYXRpb24uXG4gICAgICovXG4gICAgc2VydmVyLnNldCgncG9ydCcsIGNvbmZpZy5zZXJ2ZXIucG9ydCk7XG5cbiAgICAvLyBDb25maWd1cmUgdmlldyByZW5kZXJpbmcgZW5naW5lXG4gICAgc2VydmVyLmVuZ2luZSgnaGJzJywgaGJzLmV4cHJlc3MzKCkpO1xuICAgIHNlcnZlci5zZXQoJ3ZpZXdzJywgcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJ3ZpZXdzJykpO1xuICAgIHNlcnZlci5zZXQoJ3ZpZXcgZW5naW5lJywgJ2hicycpO1xuXG4gICAgc2VydmVyXG4gICAgICAudXNlKHRyeWNhdGNoTWlkZGxld2FyZSgpKVxuICAgICAgLnVzZShjb21wcmVzcygpKVxuICAgICAgLnVzZShmYXZpY29uKCkpXG4gICAgICAudXNlKGxvZ2dlcignZGV2JykpXG4gICAgICAudXNlKGJvZHlQYXJzZXIoKSlcbiAgICAgIC51c2UobWV0aG9kT3ZlcnJpZGUoKSlcbiAgICAgIC51c2UoZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uJywgJy4uJywgJ3B1YmxpYycpKSlcbiAgICAgIC51c2Uocm91dGVyKCkpXG4gICAgICAudXNlKGhhbmRsZTQwNCgpKTtcbiAgfVxuXG4gIGluaXRpYWxpemUoKSB7XG4gICAgcmV0dXJuIHAuYWxsKFtcbiAgICAgIHRoaXMuZGF0YWJhc2VEcml2ZXIuaW5pdGlhbGl6ZSgpLFxuICAgICAgdGhpcy5zZXJ2ZXIucHJvbWlzZS5saXN0ZW4odGhpcy5zZXJ2ZXIuZ2V0KCdwb3J0JykpXG4gICAgXSk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBBcHA7XG4iLCIoJHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKSgkX19wbGFjZWhvbGRlcl9fMCwgJF9fcGxhY2Vob2xkZXJfXzEsICRfX3BsYWNlaG9sZGVyX18yKSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==